<!DOCTYPE html>
<html>

<head lang="en">

    <meta charset="UTF-8">
    <link rel="shortcut icon" href="/ylt/favicon.ico" type="image/x-icon" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <title>医联体运维</title>
    <script src="/ylt/libs/jquery.min.js"></script>
    <script src="/ylt/libs/jquery.cookie.js"></script>
    <script src="/ylt/libs/layer/layer.js"></script>

    <link rel="stylesheet" href="/ylt/libs/kindeditor/themes/default/default.css" />
    <link rel="stylesheet" href="/ylt/libs/kindeditor/plugins/code/prettify.css" />
    <script charset="utf-8" src="/ylt/libs/kindeditor/kindeditor-all.js"></script>
    <script charset="utf-8" src="/ylt/libs/kindeditor/lang/zh-CN.js"></script>
    <script charset="utf-8" src="/ylt/libs/kindeditor/plugins/code/prettify.js"></script>

    <link rel="stylesheet" type="text/css" href="/ylt/libs/jquery-easyui-1.8.7/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="/ylt/libs/jquery-easyui-1.8.7/themes/icon.css">
    <link rel="stylesheet" type="text/css" href="/ylt/libs/jquery-easyui-1.8.7/demo/demo.css">
    <script type="text/javascript" src="/ylt/libs/jquery-easyui-1.8.7/jquery.easyui.min.js"></script>

    <script src="/ylt/libs/common.js"></script>
</head>

<script>

    var loadingPad = {
        remove: function () {
            $("#loadingPad").remove();
        }
    }


    $.parser.onComplete = function () {
        loadingPad.remove()
    }
</script>
<style>

</style>



<body style="margin:0;padding:0;">
        <div id='loadingPad' style="position: absolute; z-index: 1000; top: 0px; left: 0px; 
        width: 100%; height: 100%; background: white; text-align: center;padding:5px 10px">
        <font>loading···</font>
    </div>

    <a  href="JavaScript:void(0)" class="easyui-linkbutton alter" iconCls="icon-edit" plain="true"
    onclick="alter()">修改</a>
    <a href="/oss/page/user-protocol.html" class="easyui-linkbutton preview" iconCls="icon-look" plain="true" target="_blank">预览</a>
    <a  href="JavaScript:void(0)" class="easyui-linkbutton  confirmAlter"  style="display:none;" iconCls="icon-save" plain="true"
    onclick="confirmAlter()">确认修改</a>
    <a  href="JavaScript:void(0)" class="easyui-linkbutton  cancelAlter" style="display:none;" iconCls="icon-cancel" plain="true"
    onclick="location.reload()">取消修改</a>
        <hr/>
        <div style="width:600px;margin:auto;">
            <div id="content" style="width: 100%;border:1px solid rgb(163, 161, 161);min-height:500px;max-height:1000px;overflow: auto;"></div>
        </div>
        <hr/>
        <a  href="JavaScript:void(0)" class="easyui-linkbutton alter" iconCls="icon-edit" plain="true"
        onclick="alter()">修改</a>
        <a href="/oss/page/user-protocol.html" class="easyui-linkbutton preview" iconCls="icon-look" plain="true" target="_blank">预览</a>
        <a  href="JavaScript:void(0)" class="easyui-linkbutton  confirmAlter"  style="display:none;" iconCls="icon-save" plain="true"
        onclick="confirmAlter()">确认修改</a>
        <a  href="JavaScript:void(0)" class="easyui-linkbutton  cancelAlter" style="display:none;" iconCls="icon-cancel" plain="true"
        onclick="location.reload()">取消修改</a>
</body>

<script>




    $.get(`/oss/page/user-protocol.html?cr=${parseInt(Math.random()*10000)}`, function (data) {
        $('#content').html(data)
    })


    var contentKindEditor;
    function alter() {
        contentKindEditor = KindEditor.create('#content', {
            cssPath: '/ylt/libs/kindeditor/plugins/code/prettify.css',
            uploadJson: '/kindeditor/upload_json.jsp',
            fileManagerJson: '/kindeditor/file_manager_json.jsp',
            allowFileManager: true,
            newlineTag: "br",
            afterCreate: function () {
                var self = this;
                KindEditor.ctrl(document, 13, function () {
                    self.sync();
                    document.forms['example'].submit();
                });
                KindEditor.ctrl(self.edit.doc, 13, function () {
                    self.sync();
                    document.forms['example'].submit();
                });

                $('.alter').hide()
                $('.preview').hide()
                $('.confirmAlter').show()
                $('.cancelAlter').show()
            }
        })
    }

    function confirmAlter() {
        $.post('/ylt/maintain/set-page', { url: '/oss/page/user-protocol.html', content: contentKindEditor.html() }, function (data) {
            if (data.codeMsg)
                alert(data.codeMsg)
            if (data.code == 0) {
                alert('成功')
                location.reload()
            } else {
            }
        })


    }

</script>

</html>